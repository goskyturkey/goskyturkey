services:
  # Next.js Frontend + Express Backend
  goskyturkey:
    image: goskyturkey/goskyturkey:latest
    pull_policy: always
    container_name: goskyturkey-next
    hostname: goskyturkey
    restart: unless-stopped
    ports:
      - "3000:3000" # Backend API
      - "3001:3001" # Next.js Frontend
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongodb:27017/goskyturkey
      - JWT_SECRET=${JWT_SECRET:?JWT_SECRET is required}
      - JWT_EXPIRES_IN=7d
      - BASE_URL=${BASE_URL:-https://goskyturkey.com}
      - API_URL=http://goskyturkey:3000/api
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-https://goskyturkey.com/api}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-https://goskyturkey.com}
      - IYZICO_API_KEY=${IYZICO_API_KEY:?IYZICO_API_KEY is required}
      - IYZICO_SECRET_KEY=${IYZICO_SECRET_KEY:?IYZICO_SECRET_KEY is required}
      - IYZICO_URI=${IYZICO_URI:-https://sandbox-api.iyzipay.com}
    depends_on:
      - mongodb
    volumes:
      - uploads:/app/backend/uploads
    networks:
      goskyturkey-network:
      proxy-net:
        aliases:
          - goskyturkey

  # MongoDB Database
  mongodb:
    image: mongo:7
    container_name: goskyturkey-mongodb
    restart: unless-stopped
    ports:
      - "127.0.0.1:27017:27017"
    volumes:
      - mongodb_data:/data/db
    networks:
      - goskyturkey-network
volumes:
  mongodb_data:
  uploads:


networks:
  goskyturkey-network:
    driver: bridge
  proxy-net:
    external: true


