services:
  # Next.js Frontend + Express Backend
  goskyturkey:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-https://goskyturkey.com/api}
    container_name: goskyturkey-next
    hostname: goskyturkey
    restart: unless-stopped
    ports:
      - "3000:3000" # Backend API
      - "3001:3001" # Next.js Frontend
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongodb:27017/goskyturkey
      - JWT_SECRET=${JWT_SECRET:-please-change-this-secret}
      - JWT_EXPIRES_IN=7d
      - BASE_URL=${BASE_URL:-https://goskyturkey.com}
      - API_URL=http://goskyturkey:3000/api
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-https://goskyturkey.com/api}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-https://goskyturkey.com}
      - IYZICO_API_KEY=${IYZICO_API_KEY:-sandbox-grMq7iZ6KlekyaUB8jlYSaggfR5Dvx2t}
      - IYZICO_SECRET_KEY=${IYZICO_SECRET_KEY:-sandbox-BVD80hQI19zFU2LBorxcuLAMHbra3Myk}
      - IYZICO_URI=${IYZICO_URI:-https://sandbox-api.iyzipay.com}
    depends_on:
      - mongodb
    volumes:
      - uploads:/app/backend/uploads
    networks:
      goskyturkey-network:
      proxy-net:
        aliases:
          - goskyturkey

  # MongoDB Database
  mongodb:
    image: mongo:7
    container_name: goskyturkey-mongodb
    restart: unless-stopped
    volumes:
      - mongodb_data:/data/db
    networks:
      - goskyturkey-network

volumes:
  mongodb_data:
  uploads:


networks:
  goskyturkey-network:
    driver: bridge
  proxy-net:
    external: true
